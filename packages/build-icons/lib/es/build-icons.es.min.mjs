import{readdirSync as t,existsSync as e,unlinkSync as n,appendFileSync as r}from"node:fs";import a from"node:path";import{fileURLToPath as o}from"node:url";import{appendFileSync as i,existsSync as s,mkdirSync as c,writeFileSync as u}from"fs";import l from"path";import{fileURLToPath as f}from"url";import p from"crypto";const h=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,((t,e,n)=>n?n.toUpperCase():e.toLowerCase())),b=t=>h(t).charAt(0).toUpperCase()+h(t).slice(1),v=t=>f(new URL(t));typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;function d(t){return!("number"!=typeof t&&!/^0x[0-9a-f]+$/i.test(t))||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(t)}function g(t,e){return"constructor"===e&&"function"==typeof t[e]||"__proto__"===e}var y,m=(y=function(t,e){e||(e={});var n={bools:{},strings:{},unknownFn:null};"function"==typeof e.unknown&&(n.unknownFn=e.unknown),"boolean"==typeof e.boolean&&e.boolean?n.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach((function(t){n.bools[t]=!0}));var r={};function a(t){return r[t].some((function(t){return n.bools[t]}))}Object.keys(e.alias||{}).forEach((function(t){r[t]=[].concat(e.alias[t]),r[t].forEach((function(e){r[e]=[t].concat(r[t].filter((function(t){return e!==t})))}))})),[].concat(e.string).filter(Boolean).forEach((function(t){n.strings[t]=!0,r[t]&&[].concat(r[t]).forEach((function(t){n.strings[t]=!0}))}));var o=e.default||{},i={_:[]};function s(t,e,r){for(var a=t,o=0;o<e.length-1;o++){var i=e[o];if(g(a,i))return;void 0===a[i]&&(a[i]={}),(a[i]===Object.prototype||a[i]===Number.prototype||a[i]===String.prototype)&&(a[i]={}),a[i]===Array.prototype&&(a[i]=[]),a=a[i]}var s=e[e.length-1];g(a,s)||((a===Object.prototype||a===Number.prototype||a===String.prototype)&&(a={}),a===Array.prototype&&(a=[]),void 0===a[s]||n.bools[s]||"boolean"==typeof a[s]?a[s]=r:Array.isArray(a[s])?a[s].push(r):a[s]=[a[s],r])}function c(t,e,a){if(!a||!n.unknownFn||function(t,e){return n.allBools&&/^--[^=]+$/.test(e)||n.strings[t]||n.bools[t]||r[t]}(t,a)||!1!==n.unknownFn(a)){var o=!n.strings[t]&&d(e)?Number(e):e;s(i,t.split("."),o),(r[t]||[]).forEach((function(t){s(i,t.split("."),o)}))}}Object.keys(n.bools).forEach((function(t){c(t,void 0!==o[t]&&o[t])}));var u=[];-1!==t.indexOf("--")&&(u=t.slice(t.indexOf("--")+1),t=t.slice(0,t.indexOf("--")));for(var l=0;l<t.length;l++){var f,p,h=t[l];if(/^--.+=/.test(h)){var b=h.match(/^--([^=]+)=([\s\S]*)$/);f=b[1];var v=b[2];n.bools[f]&&(v="false"!==v),c(f,v,h)}else if(/^--no-.+/.test(h))c(f=h.match(/^--no-(.+)/)[1],!1,h);else if(/^--.+/.test(h))f=h.match(/^--(.+)/)[1],void 0===(p=t[l+1])||/^(-|--)[^-]/.test(p)||n.bools[f]||n.allBools||r[f]&&a(f)?/^(true|false)$/.test(p)?(c(f,"true"===p,h),l+=1):c(f,!n.strings[f]||"",h):(c(f,p,h),l+=1);else if(/^-[^-]+/.test(h)){for(var y=h.slice(1,-1).split(""),m=!1,_=0;_<y.length;_++)if("-"!==(p=h.slice(_+2))){if(/[A-Za-z]/.test(y[_])&&"="===p[0]){c(y[_],p.slice(1),h),m=!0;break}if(/[A-Za-z]/.test(y[_])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(p)){c(y[_],p,h),m=!0;break}if(y[_+1]&&y[_+1].match(/\W/)){c(y[_],h.slice(_+2),h),m=!0;break}c(y[_],!n.strings[y[_]]||"",h)}else c(y[_],p,h);f=h.slice(-1)[0],!m&&"-"!==f&&(!t[l+1]||/^(-|--)[^-]/.test(t[l+1])||n.bools[f]||r[f]&&a(f)?t[l+1]&&/^(true|false)$/.test(t[l+1])?(c(f,"true"===t[l+1],h),l+=1):c(f,!n.strings[f]||"",h):(c(f,t[l+1],h),l+=1))}else if((!n.unknownFn||!1!==n.unknownFn(h))&&i._.push(n.strings._||!d(h)?h:Number(h)),e.stopEarly){i._.push.apply(i._,t.slice(l+1));break}}return Object.keys(o).forEach((function(t){(function(t,e){var n=t;return e.slice(0,-1).forEach((function(t){n=n[t]||{}})),e[e.length-1]in n})(i,t.split("."))||(s(i,t.split("."),o[t]),(r[t]||[]).forEach((function(e){s(i,e.split("."),o[t])})))})),e["--"]?i["--"]=u.slice():u.forEach((function(t){i._.push(t)})),i})&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y,_={exports:{}},x=_.exports=function(){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
var t=function(t){return null!=t&&(e(t)||n(t)||!!t._isBuffer)};function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function n(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}var r=Object.prototype.toString,a=function(e){if(typeof e>"u")return"undefined";if(null===e)return"null";if(!0===e||!1===e||e instanceof Boolean)return"boolean";if("string"==typeof e||e instanceof String)return"string";if("number"==typeof e||e instanceof Number)return"number";if("function"==typeof e||e instanceof Function)return"function";if(typeof Array.isArray<"u"&&Array.isArray(e))return"array";if(e instanceof RegExp)return"regexp";if(e instanceof Date)return"date";var n=r.call(e);return"[object RegExp]"===n?"regexp":"[object Date]"===n?"date":"[object Arguments]"===n?"arguments":"[object Error]"===n?"error":t(e)?"buffer":"[object Set]"===n?"set":"[object WeakSet]"===n?"weakset":"[object Map]"===n?"map":"[object WeakMap]"===n?"weakmap":"[object Symbol]"===n?"symbol":"[object Int8Array]"===n?"int8array":"[object Uint8Array]"===n?"uint8array":"[object Uint8ClampedArray]"===n?"uint8clampedarray":"[object Int16Array]"===n?"int16array":"[object Uint16Array]"===n?"uint16array":"[object Int32Array]"===n?"int32array":"[object Uint32Array]"===n?"uint32array":"[object Float32Array]"===n?"float32array":"[object Float64Array]"===n?"float64array":"object"};function o(t,e){return t(e={exports:{}},e.exports),e.exports}var i=o((function(t){!function(){function e(t,e){if("function"!=typeof e)return t;var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[e(r,t[r])||r]=t[r]);return n}t.exports?t.exports=e:window.rename=e}()})),s=function t(e,n){var r=a(e);if("object"!==r&&"array"!==r)throw new Error("expected an object");var o=[];for(var s in"object"===r&&(e=i(e,n),o={}),e)if(e.hasOwnProperty(s)){var c=e[s];"object"===a(c)||"array"===a(c)?o[s]=t(c,n):o[s]=c}return o},c=o((function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var t,r,a=[];if(0===this._eventsCount)return a;for(r in t=this._events)e.call(t,r)&&a.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(t)):a},o.prototype.listeners=function(t,e){var r=n?n+t:t,a=this._events[r];if(e)return!!a;if(!a)return[];if(a.fn)return[a.fn];for(var o=0,i=a.length,s=new Array(i);o<i;o++)s[o]=a[o].fn;return s},o.prototype.emit=function(t,e,r,a,o,i){var s=n?n+t:t;if(!this._events[s])return!1;var c,u,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,a),!0;case 5:return l.fn.call(l.context,e,r,a,o),!0;case 6:return l.fn.call(l.context,e,r,a,o,i),!0}for(u=1,c=new Array(f-1);u<f;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),f){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,r);break;case 4:l[u].fn.call(l[u].context,e,r,a);break;default:if(!c)for(p=1,c=new Array(f-1);p<f;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},o.prototype.on=function(t,e,r){var o=new a(e,r||this),i=n?n+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},o.prototype.once=function(t,e,r){var o=new a(e,r||this,!0),i=n?n+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},o.prototype.removeListener=function(t,e,a,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return 0==--this._eventsCount?this._events=new r:delete this._events[i],this;var s=this._events[i];if(s.fn)s.fn===e&&(!o||s.once)&&(!a||s.context===a)&&(0==--this._eventsCount?this._events=new r:delete this._events[i]);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==e||o&&!s[c].once||a&&s[c].context!==a)&&u.push(s[c]);u.length?this._events[i]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new r:delete this._events[i]}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new r:delete this._events[e])):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=n,o.EventEmitter=o,t.exports=o}));function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(){},f={data:"state-data",cdata:"state-cdata",tagBegin:"state-tag-begin",tagName:"state-tag-name",tagEnd:"state-tag-end",attributeNameStart:"state-attribute-name-start",attributeName:"state-attribute-name",attributeNameEnd:"state-attribute-name-end",attributeValueBegin:"state-attribute-value-begin",attributeValue:"state-attribute-value"},p={lt:"action-lt",gt:"action-gt",space:"action-space",equal:"action-equal",quote:"action-quote",slash:"action-slash",char:"action-char",error:"action-error"},h={text:"text",openTag:"open-tag",closeTag:"close-tag",attributeName:"attribute-name",attributeValue:"attribute-value"},b={" ":p.space,"\t":p.space,"\n":p.space,"\r":p.space,"<":p.lt,">":p.gt,'"':p.quote,"'":p.quote,"=":p.equal,"/":p.slash},v=function(t){return b[t]||p.char},d={State:f,Action:p,Type:h,create:function(t){var e,n,r,a,o,i,s,b,d,g;t=Object.assign({debug:!1},t);var y=new c,m=f.data,_="",x="",w="",j="",A="",N="",E=function(e,n){if("?"!==x[0]&&"!"!==x[0]){var r={type:e,value:n};t.debug&&console.log("emit:",r),y.emit("data",r)}};y.stateMachine=(u(g={},f.data,(u(e={},p.lt,(function(){_.trim()&&E(h.text,_),x="",A=!1,m=f.tagBegin})),u(e,p.char,(function(t){_+=t})),e)),u(g,f.cdata,u({},p.char,(function(t){"]]>"===(_+=t).substr(-3)&&(E(h.text,_.slice(0,-3)),_="",m=f.data)}))),u(g,f.tagBegin,(u(n={},p.space,l),u(n,p.char,(function(t){x=t,m=f.tagName})),u(n,p.slash,(function(){x="",A=!0})),n)),u(g,f.tagName,(u(r={},p.space,(function(){A?m=f.tagEnd:(m=f.attributeNameStart,E(h.openTag,x))})),u(r,p.gt,(function(){E(A?h.closeTag:h.openTag,x),_="",m=f.data})),u(r,p.slash,(function(){m=f.tagEnd,E(h.openTag,x)})),u(r,p.char,(function(t){"![CDATA["===(x+=t)&&(m=f.cdata,_="",x="")})),r)),u(g,f.tagEnd,(u(a={},p.gt,(function(){E(h.closeTag,x),_="",m=f.data})),u(a,p.char,l),a)),u(g,f.attributeNameStart,(u(o={},p.char,(function(t){w=t,m=f.attributeName})),u(o,p.gt,(function(){_="",m=f.data})),u(o,p.space,l),u(o,p.slash,(function(){A=!0,m=f.tagEnd})),o)),u(g,f.attributeName,(u(i={},p.space,(function(){m=f.attributeNameEnd})),u(i,p.equal,(function(){E(h.attributeName,w),m=f.attributeValueBegin})),u(i,p.gt,(function(){j="",E(h.attributeName,w),E(h.attributeValue,j),_="",m=f.data})),u(i,p.slash,(function(){A=!0,j="",E(h.attributeName,w),E(h.attributeValue,j),m=f.tagEnd})),u(i,p.char,(function(t){w+=t})),i)),u(g,f.attributeNameEnd,(u(s={},p.space,l),u(s,p.equal,(function(){E(h.attributeName,w),m=f.attributeValueBegin})),u(s,p.gt,(function(){j="",E(h.attributeName,w),E(h.attributeValue,j),_="",m=f.data})),u(s,p.char,(function(t){j="",E(h.attributeName,w),E(h.attributeValue,j),w=t,m=f.attributeName})),s)),u(g,f.attributeValueBegin,(u(b={},p.space,l),u(b,p.quote,(function(t){N=t,j="",m=f.attributeValue})),u(b,p.gt,(function(){j="",E(h.attributeValue,j),_="",m=f.data})),u(b,p.char,(function(t){N="",j=t,m=f.attributeValue})),b)),u(g,f.attributeValue,(u(d={},p.space,(function(t){N?j+=t:(E(h.attributeValue,j),m=f.attributeNameStart)})),u(d,p.quote,(function(t){N===t?(E(h.attributeValue,j),m=f.attributeNameStart):j+=t})),u(d,p.gt,(function(t){N?j+=t:(E(h.attributeValue,j),_="",m=f.data)})),u(d,p.slash,(function(t){N?j+=t:(E(h.attributeValue,j),A=!0,m=f.tagEnd)})),u(d,p.char,(function(t){j+=t})),d)),g);var k=function(e){t.debug&&console.log(m,e);var n=y.stateMachine[m];(n[v(e)]||n[p.error]||n[p.char])(e)};return y.write=function(t){for(var e=t.length,n=0;n<e;n++)k(t[n])},y}},g=d.Type,y={element:"element",text:"text"},m=function(t){return Object.assign({name:"",type:y.element,value:"",parent:null,attributes:{},children:[]},t)},_=function(t){t=Object.assign({stream:!1,parentNodes:!0,doneEvent:"done",tagPrefix:"tag:",emitTopLevelOnly:!1,debug:!1},t);var e=void 0,n=void 0,r=void 0,a=void 0,o=new c,i=function(i){switch(i.type){case g.openTag:if(null===r)(r=n).name=i.value;else{var s=m({name:i.value,parent:r});r.children.push(s),r=s}break;case g.closeTag:var c=r.parent;if(t.parentNodes||(r.parent=null),r.name!==i.value)break;t.stream&&c===n&&(n.children=[],r.parent=null),(!t.emitTopLevelOnly||c===n)&&(o.emit(t.tagPrefix+r.name,r),o.emit("tag",r.name,r)),r===n&&(e.removeAllListeners("data"),o.emit(t.doneEvent,r),n=null),r=c;break;case g.text:r&&r.children.push(m({type:y.text,value:i.value,parent:t.parentNodes?r:null}));break;case g.attributeName:a=i.value,r.attributes[a]="";break;case g.attributeValue:r.attributes[a]=i.value}};return o.reset=function(){(e=d.create({debug:t.debug})).on("data",i),n=m(),r=null,a="",o.parse=e.write},o.reset(),o},x=function(t,e){e=Object.assign({},e,{stream:!1,tagPrefix:":"});var n=_(e),r=void 0;return n.on("done",(function(t){r=t})),n.parse(t),r},w=function(t){var e=x("<root>".concat(t,"</root>"),{parentNodes:!1});if(e.children&&e.children.length>0&&e.children.every((function(t){return"svg"===t.name})))return 1===e.children.length?e.children[0]:e.children;throw Error("nothing to parse")},j=function(t){return s(t,(function(t){return N(t)?t:A(t)}))},A=function(t){return t.replace(/[-|:]([a-z])/gi,(function(t,e){return e.toUpperCase()}))},N=function(t){return/^(data|aria)(-\w+)/.test(t)},E=function(t){if(t){var e=String(t);return/[&<>]/.test(e)?"<![CDATA[".concat(e.replace(/]]>/,"]]]]><![CDATA[>"),"]]>"):e}return""},k=function(t){return String(t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},O=function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.transformNode,o=void 0===a?function(t){return t}:a,i=r.camelcase,s=void 0!==i&&i;return e=w(t),n=o(e),s&&(n=j(n)),n};function S(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new Promise((function(t,n){try{t(O.apply(void 0,e))}catch(t){n(t)}}))}var $=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.transformAttr,a=void 0===r?function(t,e,n){return"".concat(t,'="').concat(n(e),'"')}:r,o=n.transformNode,i=void 0===o?function(t){return t}:o,s=n.selfClose,c=void 0===s||s;if(Array.isArray(e))return e.map((function(e){return t(e,{transformAttr:a,selfClose:c,transformNode:i})})).join("");var u=i(e);if("text"===u.type)return E(u.value);var l="";for(var f in u.attributes){var p=a(f,u.attributes[f],k,u.name);l+=p?" ".concat(p):""}return u.children&&u.children.length>0||!c?"<".concat(u.name).concat(l,">").concat(t(u.children,{transformAttr:a,transformNode:i,selfClose:c}),"</").concat(u.name,">"):"<".concat(u.name).concat(l,"/>")};return Object.assign({},{parse:S,parseSync:O,stringify:$})}();const{pkg:w="react"}=m(process.argv.slice(2)),j=(t=>o(new URL(t)))(import.meta.url),A=a.resolve(j,"../../static/icons"),N=a.resolve(j,"../../static/icon-nodes.json"),E=a.resolve(j,`../../${w}/icons`);let k=0;e(`${E}/index.ts`)&&n(`${E}/index.ts`),e(E)&&n(N),t(A).forEach((async(e,n)=>{if("index.ts"!==e){const n=(e=>t(e).map((t=>t.replace(/.svg/,""))))(a.resolve(A,e)).sort(((t,e)=>t.localeCompare(e)));n.forEach((async t=>{const o=a.resolve(A,`${e}/${t}.svg`),f=await(async t=>await Bun.file(t).text())(o),h=x.parseSync(f);h.children.forEach((t=>{t.attributes.key||(t.attributes.key=p.randomBytes(20).toString("hex")),"#000"===t.attributes.fill&&(t.attributes.fill="currentColor")}));const d=n.reduce(((e,{name:n})=>(e[t]=h.children.map((({name:t,attributes:e})=>[t,e])),e)),{});r(N,`${JSON.stringify(d,null,2)},\n`),((t,e="react")=>{const n=Object.keys(t)[0],r=Object.values(t)[0],a=v(import.meta.url),o=l.resolve(a,`../../${e}/icons`);s(o)||c(o);const i=`\n  import createMeisterIcons from '../src/createMeisterIcons';\n\n  const ${b(n)} = createMeisterIcons("${n}", ${JSON.stringify(r)})\n\n\n  export default ${b(n)}\n  `;u(l.join(o,`${b(n)}.ts`),i,"utf-8")})(d,w),((t,e="react")=>{const n=v(import.meta.url),r=l.resolve(n,`../../${e}/icons`),a=`export {default as  ${b(t)}} from './${b(t)}';\n`;i(l.resolve(r,"index.ts"),a,"utf-8")})(t,w)})),k+=n.length,console.log(`Generated ${n.length} icons for ${e} category`)}})),console.log(`Generated ${k} icons.- ${w}`);
